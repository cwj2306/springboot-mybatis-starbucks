<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!-- repository 패키지 경로.내xml파일명Repository 로생성 -->
<mapper namespace="com.cos.starbucks.repository.MypageRepository">

	<select id="findByUserId"
		resultType="com.cos.starbucks.model.MyCoffee">
		select * from myCoffee where userId= #{?}
	</select>
	
	<select id="findByUserIdBev"
		resultType="com.cos.starbucks.model.MyBeverage">
		select * from myBeverage where userId= #{?}
	</select>
	
	<select id="findByUserIdCard"
		resultType="com.cos.starbucks.model.User_card">
		select * from user_card where userId= #{?}
	</select>
	
		<select id="countByUserId" resultType="Integer">
		select count(*) from user_card where userId= #{?}
	</select>
	
	<select id="findCardPoint" resultType="Integer">
		select point from user_card where userId=#{?} 
	</select>
	
	<select id="checkMyCoffee" resultType="Integer">
		select userId from myCoffee where id=#{?} 
	</select>
	
	<select id="checkMyBev" resultType="Integer">
		select userId from myBeverage where id=#{?} 
	</select>
	
	<select id="checkMyCard" resultType="Integer">
		select userId from user_card where id=#{?} 
	</select>
	
	<select id="findCoffeePrice" resultType="Integer">
	select c.price from myCoffee m, coffee c where m.userId=#{userId} and m.id=${id} and m.coffeeId=c.id;
	</select>
	
	<select id="findBevPrice" resultType="Integer">
	select b.price from myBeverage m, beverage b where m.userId=#{userId} and m.id=${id} and m.beverageId=b.id;
	</select>
	
	<select id="findCoffeeId" resultType="Integer">
	select coffeeId from myCoffee where id=#{?}
	</select>
	
	<select id="findBevId" resultType="Integer">
	select beverageId from myBeverage where id=#{?}
	</select>
	<select id="findCoffeeName" resultType="String">
	select name from coffee where id=#{?}
	</select>
	<select id="findBevName" resultType="String">
	select name from beverage where id=#{?}
	</select>
	
	<select id="CheckCardExist" resultType="com.cos.starbucks.model.User_card">
	select * from User_card where userId=#{?}
	</select>
	
	<select id="findTradeLog" resultType="com.cos.starbucks.model.Trade">
	select * from trade where userId=#{?} order by createDate desc
	</select>
	
	<select id="findAmountByUserId" resultType="Integer">
	select sum(amount) from trade where userId=#{?}
	</select>
	
	
	<insert id="coffeeSave">
		insert into myCoffee(coffeeId,userId,coffeeName,createDate,price)
		values(#{coffeeId},#{userId},#{coffeeName},now(),#{price})
	</insert>
	
	<insert id="bevSave">
		insert into myBeverage(beverageId,userId,beverageName,createDate,price)
		values(#{bevId},#{userId},#{bevName},now(),#{price})
	</insert>
	
	<insert id="cardSave">
		insert into user_card(cardId,userId,cardName,cardImage,createDate)
		values(#{cardId},#{userId},#{cardName},#{cardImage},now())
	</insert>
	
	<insert id="trade">
	insert into trade(userId,name,price,createDate,amount) values(#{userId},#{name},#{price},now(),#{amount})
	</insert>
	
	<update id="updatePoint">
	update user_card set point=#{point} where userId=#{id} 
	</update>
	
	<delete id="deleteCoffee">
		delete from myCoffee where id=#{id}
	</delete>

	<delete id="deleteBev">
		delete from myBeverage where id=#{id}
	</delete>
	<delete id="deleteCard">
		delete from user_card where id=#{id}
	</delete>
	
	<!-- 안드로이드  -->
	<insert id="AcardSave">
		insert into user_card(cardId,userId,cardName,cardImage,createDate) 
		values(#{cardId},#{userId},#{cardName},#{cardImage},now())
	</insert>
	
	
	<insert id="Acart">
		insert into cart(userId,name,price,createDate) values(#{userId},#{name},#{price},now())
	</insert>
	
	<select id="AcartfindbyuserId" resultType="com.cos.starbucks.model.Cart">
		select * from cart where userId=#{?} ORDER BY id DESC 
	</select>
	
	<select id="AfindExistProduct" resultType="com.cos.starbucks.model.Cart">
		select * from cart where userId=#{userId} and name =#{name}
	</select>
	
	<delete id="AdeleteCart">
		delete from cart where id=#{id}
	</delete>
	
	<delete id="AdeleteCartOrder">
		delete from cart where userId=#{userId}
	</delete>


	<select id="AfindMyBeverage" resultType="Integer">
		select count(*) from myBeverage where userId=#{userId} and beverageId=#{beverageId}
	</select>
	
	<select id="AfindMyCoffee" resultType="Integer">
		select count(*) from myCoffee where userId=#{userId} and coffeeId=#{coffeeId}
	</select>
	
	<delete id="AdeleteMyBeverage">
		delete from myBeverage where userId=#{userId} and beverageId=#{beverageId}
	</delete>
	
	<delete id="AdeleteMyCoffee">
		delete from myCoffee where userId=#{userId} and coffeeId=#{coffeeId} 
	</delete>
	
</mapper>